<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <!-- css -->
  <link rel="stylesheet" href="js/element-2.4.11/theme-chalk/index.css">
  <link rel="stylesheet" href="css/fontawesome5.6.3/css/all.css">
  <link rel="stylesheet" href="css/index.css">
  <link rel="stylesheet" href="arcgis_js_api/library/4.5/dijit/themes/claro/claro.css" />
  <link rel="stylesheet" href="arcgis_js_api/library/4.5/esri/css/main.css" />
 <!--  <link rel="stylesheet" href="https://js.arcgis.com/4.12/esri/themes/light/main.css"> -->
  <style>
	  .text {
	    font-size: 14px;
	  }
	
	  .item {
	    margin-bottom: 18px;
	  }
	
	  .clearfix:before,
	  .clearfix:after {
	    display: table;
	    content: "";
	  }
	  .clearfix:after {
	    clear: both
	  }
	
	  .box-card {
	    width: 480px;
	  }
  </style>
</head>
<body class="animated fadeIn">
  <div id="app">
  	
  	<div v-show="!preloading" class="el-loading-mask" style="background-color: rgba(255,255,255,1);">
	   <div class="el-loading-spinner">
	    <i class="fa fa-spinner fa-pulse"></i>
 	    <p class="el-loading-text">Loading...</p>
	   </div>
    </div>
    
    <section style="padding: 20px;" v-show="preloading">
		<!-- filter -->
		<el-row>
		<el-col :span="24" class="toolbar" style="padding-bottom: 0px;">
			<el-col :span="24">
			<el-tabs value="filter" >
			    <el-tab-pane label="筛选" name="filter" disabled>
			    <el-form size="mini" :inline="true" :model="filters" style="float: right;">
					<el-form-item>
					    <el-select v-model="filters.type" placeholder="请选择">
					      <el-option label="航标" value="1"></el-option>
					      <el-option label="仓库" value="2"></el-option>
					    </el-select>
					</el-form-item>
					<el-form-item v-if="filters.type == 1">
					    <el-select v-model="filters.sAid_ID" placeholder="请选择航标">
						    <el-option
						      v-for="item in aidOptions"
						      :key="item.sAid_ID"
						      :label="item.sAid_Name"
						      :value="item.sAid_ID">
						    </el-option>
					    </el-select>
					</el-form-item>
					<el-form-item v-if="filters.type == 2">
					    <el-select v-model="filters.sStoreType_ID" placeholder="请选择仓库">
						    <el-option
						      v-for="item in storeTypeOptions"
						      :key="item.sStoreType_ID"
						      :label="item.sStoreType_Name"
						      :value="item.sStoreType_ID">
						    </el-option>
					    </el-select>
					</el-form-item>
					<el-form-item>
						<el-button type="primary" title="查询" @click="query" icon="fa fa-search"></el-button>
						<el-button @click="reset"  title="重置" icon="fas fa-redo"></el-button>
					</el-form-item>
				</el-form>
			    </el-tab-pane>
		    </el-tabs>
				
			</el-col>
		</el-col>
		</el-row>
		
	    <el-tabs v-model="activeTab" >
		    <el-tab-pane label="结果" name="table" disabled ref="query" auth="sys:map:query" v-show="hasAuth('query')">
				<div id="mapView" style="width: 100%;height: 500px;"></div>
			</el-tab-pane>
		  </el-tabs>
		
		
		<!-- detail -->
		<!-- <el-dialog title="详情" :visible.sync="addFormVisible" :close-on-click-modal="false">	
			<el-form size="mini" :model="addForm" :rules="addFormRules" ref="addForm" label-width="120px">
			  <el-form-item label="应用名称" prop="sApp_Name">
			    <el-input v-model="addForm.sApp_Name"></el-input>
			  </el-form-item>
			  <el-form-item label="应用编码" prop="sApp_NO">
			    <el-input v-model="addForm.sApp_NO">
			    	<el-button slot="append" icon="fas fa-random" @click="handleRandom('addForm', 'sApp_NO')">随机生成</el-button>
			    </el-input>
			  </el-form-item>
			  <el-form-item label="应用秘钥" prop="sApp_SecretKey">
			    <el-input v-model="addForm.sApp_SecretKey">
			    	<el-button slot="append" icon="fas fa-random" @click="handleRandom('addForm', 'sApp_SecretKey')">随机生成</el-button>
			    </el-input>
			  </el-form-item>
			  <el-form-item label="状态" prop="lApp_StatusFlag">
			     <el-switch v-model="addForm.lApp_StatusFlag" :active-value="1" :inactive-value="0"></el-switch>
			  </el-form-item>
			</el-form>
			<div slot="footer" class="dialog-footer">
				<el-button size="mini" @click="addClose">取消</el-button>
				<el-button size="mini" type="primary" @click="addSubmit" :loading="addLoading">提交</el-button>
			</div>
		</el-dialog> -->
		
		<el-card id="details" class="box-card" v-show="detailFormVisible" :body-style="{maxHeight: '350px', overflow: 'auto' }">
		  <div slot="header" class="clearfix">
		    <span>{{detailTitle}}</span>
		    <el-button style="float: right; padding: 3px 0" type="text" class="el-dialog__headerbtn" @click="detailClose">
		    	<i class="el-dialog__close el-icon-close"></i>
		    </el-button>
		  </div>
	      <div v-if="detailType == 'aid'" class="text item">
			  <el-collapse v-model="activeNames" >
				  <el-collapse-item title="基础信息" name="1">
			  		<!-- base -->
				    <el-form size="mini" :model="detailForm" ref="detailForm" label-width="120px">
					  <el-form-item label="航标名称" prop="sAid_Name">
					    <el-input v-model="detailForm.sAid_Name" readonly></el-input>
					  </el-form-item>
					  <el-form-item label="航标编码" prop="sAid_NO">
					    <el-input v-model="detailForm.sAid_NO" readonly></el-input>
					  </el-form-item>
					  <el-form-item label="航标种类" prop="sAid_TypeName">
					    <el-input v-model="detailForm.sAid_TypeName" readonly></el-input>
					  </el-form-item>
					  <el-form-item label="经度" prop="lAid_Lng">
					    <el-input v-model="detailForm.lng" readonly></el-input>
					  </el-form-item>
					  <el-form-item label="纬度" prop="lAid_Lat">
					    <el-input v-model="detailForm.lat" readonly></el-input>
					  </el-form-item>
					  <el-form-item label="所属航标站" prop="sAid_StationName">
					    <el-input v-model="detailForm.sAid_StationName" readonly></el-input>
					  </el-form-item>
					  <el-form-item label="灯质明灭" prop="sAid_LightingName">
					    <el-input v-model="detailForm.sAid_LightingName" readonly></el-input>
					  </el-form-item>
					  <el-form-item label="航标设置" prop="sAid_MarkName">
					    <el-input v-model="detailForm.sAid_MarkName" readonly></el-input>
					  </el-form-item>
					  <el-form-item label="航标ICON" prop="sAid_IconName">
					    <!-- <el-input v-model="detailForm.sAid_IconName" readonly></el-input> -->
					    <div style="width: 45px; height: 45px;">
							<img v-if="detailForm.sAid_IconName" :src="'/'+detailForm.sAid_IconName" style="max-width: 100%;max-height: 100%;"/>
						</div>
					  </el-form-item>
					  <el-form-item label="状态" prop="sAid_StatusName">
					    <el-input v-model="detailForm.sAid_StatusName" readonly></el-input>
					  </el-form-item>
					</el-form>
					
				  </el-collapse-item>
				  <el-collapse-item title="器材列表" name="2">
				  			<el-row>
				  				<el-col :span="8">编码</el-col>
				  				<el-col :span="8">分类</el-col>
				  				<el-col :span="8">使用日期</el-col>
				  			</el-row>
			  			<!-- 器材 -->
				  		<div v-for="(item, index) in aidEquipOptions" :key="index">
				  			<el-row>
				  				<el-col :span="8">{{item.sEquip_NO}}</el-col>
				  				<el-col :span="8">{{item.sAidEquip_EquipTypeName}}</el-col>
				  				<el-col :span="8">{{formatDateStr(item.dAidEquip_CreateDate, 'yyyy-MM-dd')}}</el-col>
				  			</el-row>
				  		</div>
				  </el-collapse-item>
			  </el-collapse>
			</div>
			  <div v-if="detailType == 'store'" class="text item">
			    <el-form size="mini" :model="detailForm" ref="detailForm" label-width="120px">
				  <el-form-item label="仓库名称" prop="sStoreType_Name">
				    <el-input v-model="detailForm.sStoreType_Name" readonly></el-input>
				  </el-form-item>
				  <el-form-item label="仓库地址" prop="sStoreType_Address">
				    <el-input v-model="detailForm.sStoreType_Address" readonly></el-input>
				  </el-form-item>
				  <el-form-item label="经度" prop="lStoreType_Lng">
				    <el-input v-model="detailForm.lng" readonly></el-input>
				  </el-form-item>
				  <el-form-item label="纬度" prop="lStoreType_Lat">
				    <el-input v-model="detailForm.lat" readonly></el-input>
				  </el-form-item>
				  <el-form-item label="所属航标站" prop="sStoreType_StationName">
				    <el-input v-model="detailForm.sStoreType_StationName" readonly></el-input>
				  </el-form-item>
				</el-form>
			  </div>	
		  
		</el-card>
		
	</section>
  </div>
</body>
  <script src="js/jquery-3.4.1.js" type="text/javascript"></script>
  <script src="js/vue-2.6.10/vue.js" type="text/javascript"></script>
  <script src="js/element-2.4.11/index.js" type="text/javascript"></script>
  
  <script>
  
  function ajaxReqSync(url, param, callback, cp){
		$.ajax({
			   dataType: "json",
			   type: "POST",
			   url: url,
			   data: param,
			   async: false,
			   headers: {
			        token: parent.window.loginToken
			    },
			   success: function(data){
				   	if(data.code == -203 || data.code == -111){ // token 超时
				   		parent.window.location.href = "login.html";
				   	}
					if (typeof callback === "function") {
						callback(data, cp);
					}
			   },
			   error: function(data){
			   }
			});
	};
	
	var data;
	ajaxReqSync("/api/sys/findOne", {}, function(res){
		if(res.code > 0){
			data = res.data;
		}
	});
	
	   var Center = {lat: data.lSys_MapLat, lng: data.lSys_MapLng};	
	   var ArGis = {
	   		baseUrl: "arcgis_js_api/library/4.5",
	   		mapUrl: data.sSys_MapService,
	   		map: "",
			view: "",
			center: [Center.lng, Center.lat],
			zoom: data.lSys_MapLevel
	   };
  </script>
  <script src="arcgis_js_api/library/4.5/init.js"></script>
  
<!-- <script src="https://js.arcgis.com/4.12/"></script> -->
    
  <script type="text/javascript" src="js/global.js"></script>
  <script type="text/javascript" src="js/map.js"></script>
</html>